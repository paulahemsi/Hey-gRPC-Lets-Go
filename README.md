# Hey-gRPC-Lets-Go
gRPC implementation using python


>Your next API doesnâ€™t need to be built with REST and JSON. How about gRPC and Protocol Buffers for better performance and structure?
quote from [this article](https://towardsdatascience.com/implementing-grpc-server-using-python-9dc42e8daea0) by Martin Heinz


`RPC` = **Remote Procedure Call**

`protobufs` or just `proto` = **Protocol Buffers** = Message format

Protobufs are alternative to JSON or XML, a smaller, simpler and more efficient way of serializing data.

A client application can call methods aveilable on a remote server, it doesn't matter in what language as long as you have *stubs* (generated by gRPC)

To use it, first in necessary to define how the massagens will look in the `.proto` file.

the first line in the file needs to tell we are using the last version os proto, proto3

```proto
syntax = "proto3";
```

the messagens are somehow like enumerators

```proto
message HeyHow {
	int32 count = 1;
	string msg = 2;
}

message LetsGo {
	int32 count = 1;
	string msg = 2;
	string anything = 3;
}
```

We also need to define the services and their rpc methods

```proto
service HeyHowService {
	rpc heyhow (HeyHow) returns (LetsGo) {}
}
```

### Why gRPC over REST?

* better performance
* HTTP/2
* clearly defined and stricter contract

setup

```bash
pip install grpcio
pip install grpcio-tools
```

To generate server and client interfaces:

```bash
python -m grpc_tools.protoc -I./proto --python_out=./generated --grpc_python_out=./generated ./proto/hey_how.proto 
```
`-I./proto` path to *.proto* files
`--python_out=./generated` `--grpc_python_out=./generated` where to output the generateds files *_pb2.py* and *_grpc_pb2.py*
`./proto/hey_how.proto` path to *.proto* file (yes, we this and the first one too, actuly the first defines tha path and here we need to write also the file name)

now we have out generates files :

`*_pb2_grpc.py`
`*_pb2.py`


### *_pb2_grpc.py:

`Servicer` - class used by the server to implement the gRPC service

```py
class HeyHowServiceServicer(object):
```

`Stub` - class used by the client to connect the gRPC service:

```py
class HeyHowServiceStub(object):
```

`Registration funcionn`- needed to register servicer with gRPC server

```py
def add_HeyHowServiceServicer_to_server(servicer, server):
    rpc_method_handlers = {
            'heyhow': grpc.unary_unary_rpc_method_handler(
                    servicer.heyhow,
                    request_deserializer=hey__how__pb2.HeyHow.FromString,
                    response_serializer=hey__how__pb2.LetsGo.SerializeToString,
            ),
    }
    generic_handler = grpc.method_handlers_generic_handler(
            'HeyHowService', rpc_method_handlers)
    server.add_generic_rpc_handlers((generic_handler,))
```


in grpc.py we create a class that inherits from the generated Servicer ans contains the methods defined in `.proto`

> All these methods are intended to be overridden in our implementation and here we do just that.

`request` is an instance of our `message LetsGo`, the reply part of the `.proto`file, so we have access to the `msg` message

`context` contains RPC informations, like timeouts limits

```py
class Echoer (heyhow_pb2_grpc.HeyHowServiceServicer):
	def Reply(self, request, context):
		return heyhow_pb2.LetsGo(msg=f'{request.msg}')
```

>in case you wanted to leverage the response-streaming you could replace return with yield and return multiple responses (in for cycle)





do the serialization and deserialization that we will use

```
hey_how_pb2_grpc.add_HeyHowServiceServicer_to_server
```


and this

```python
       self.heyhow = channel.unary_unary(
                '/HeyHowService/heyhow',
                request_serializer=hey__how__pb2.HeyHow.SerializeToString,
                response_deserializer=hey__how__pb2.LetsGo.FromString,
                )
```

works in the client

```
response = stub.heyhow()
```

## Study resources

* [Implementing gRPC server using Python](https://towardsdatascience.com/implementing-grpc-server-using-python-9dc42e8daea0) by Martin Heinz
* [10000 Messages in 2.18 seconds with Python and gRPC](https://www.youtube.com/watch?v=dQK0VLahrDk) by seanwasere ytbe
* [gRPC Crash Course - Modes, Examples, Pros & Cons and more](https://www.youtube.com/watch?v=Yw4rkaTc0f8) by Hussein Nasser

